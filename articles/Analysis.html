<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="psborrow">
<title>Analysing data with psborrow • psborrow</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysing data with psborrow">
<meta property="og:description" content="psborrow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">psborrow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Analysis.html">Analysing data with psborrow</a>
    <a class="dropdown-item" href="../articles/user_guide.html">User Guide: Dynamic Borrowing with psborrow</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Analysing data with psborrow</h1>
            
      
      
      <div class="d-none name"><code>Analysis.Rmd</code></div>
    </div>

    
    
<p>This vignette provides additional details of the analysis model that
is fitted as well as a demonstration of how to use the package to fit
said models to an existing dataset. For examples of how to fit the
analysis model to the simulated datasets generated by the package
itself, please see the user-guide vignette.</p>
<p>The “Analysis Model” section of this vignette is a modified excerpt
from Lu, Y. et al. (2021).</p>
<div class="section level2">
<h2 id="analysis-model">Analysis Model<a class="anchor" aria-label="anchor" href="#analysis-model"></a>
</h2>
<p>The package uses Markov chain Monte Carlo (MCMC) through JAGS to
obtain the posterior distribution for the hazard ratio between treatment
and control arms. The package relies on the Bayesian commensurate prior
approach (Lewis, et al., 2019). The probability density function for the
survival time of patient <span class="math inline">\(i\)</span>
following a Weibull model is as below:</p>
<p><span class="math display">\[
t_i \sim Weibull( \nu, \lambda_i)
\]</span></p>
<p>for <span class="math inline">\(i = 1, 2, \dots,n\)</span>,
where:</p>
<ul>
<li>
<span class="math inline">\(\nu\)</span> is the shape parameter</li>
<li>
<span class="math inline">\(\lambda\)</span> is the rate,</li>
<li>
<span class="math inline">\(n\)</span> is the total sample size of
the analysis population.</li>
</ul>
<p>The probability density function is:</p>
<p><span class="math display">\[
f(t_i, x_i) = \nu\lambda_i t^{\nu-1} e^{-\lambda_it^\nu}
\]</span></p>
<p>with the rate taking the format:</p>
<p><span class="math display">\[
\lambda_i = exp(\alpha_i + \beta_{trt}  \times I_{trt} + \beta^T \times
X_{i})
\]</span></p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(\alpha_i = \alpha_{cc}\)</span> if
patient <span class="math inline">\(i\)</span> is in the concurrent
trial, and <span class="math inline">\(\alpha_i = \alpha_{ec}\)</span>
if patient <span class="math inline">\(i\)</span> is in the external
trial. Because the impact of therapy is captured by <span class="math inline">\(I_{trt}\)</span> below, <span class="math inline">\(\alpha_{cc}\)</span> and <span class="math inline">\(\alpha_{ec}\)</span> effectively correspond to the
log of baseline hazard rate for concurrent control arm and external
control arm, respectively.</li>
<li>
<span class="math inline">\(\beta_n\)</span> is an n-length vector
of regression coefficients<br>
</li>
<li>
<span class="math inline">\(X_{ni}\)</span> is an n-length covariate
vector for patient <span class="math inline">\(i\)</span>, including all
additional parameters to adjust for (e.g. propensity score).<br>
</li>
<li>
<span class="math inline">\(I_{trt}\)</span> is the treatment
indicator (value equals to 0 or 1).</li>
</ul>
<p>A hierarchical model is defined in which the log hazard rate for the
concurrent controls is centered on the external controls, i.e. <span class="math inline">\(\alpha_{cc} | \alpha_{ec} \sim N(\alpha_{ec},
\tau)\)</span>. The hyperprior <span class="math inline">\(\tau\)</span>, also referred to as the
commensurability parameter, determines the extent of borrowing (see
Lewis, et al., 2019).</p>
<p>Four borrowing methods have been implemented:</p>
<ol style="list-style-type: decimal">
<li>Not borrowing any external control information</li>
<li>Fully incorporating external control arm patients to the concurrent
control group</li>
<li>Dynamic borrowing with the commensurability hyperparameter <span class="math inline">\(\tau\)</span> following a Gamma distribution</li>
<li>Dynamic borrowing with the commensurability hyperparameter <span class="math inline">\(\tau\)</span> following a half-Cauchy
distribution</li>
</ol>
<p>For methods (1) and (2), a conventional Bayesian model without
dynamic borrowing is deployed with all relevant parameters assigned a
non-informative prior. For method (1) no external control arm
information is used and as such <span class="math inline">\(\alpha_{cc}
= \alpha \sim N(0, 0.0001)\)</span> For method (2) the external control
arm is treated as part of the concurrent control and as such <span class="math inline">\(\alpha_{cc} = \alpha_{ec} = \alpha \sim N(0,
0.0001)\)</span>.</p>
<p>In comparison, methods (3) and (4) have the commensurability
hyper-parameter <span class="math inline">\(\tau\)</span>, which acts as
the precision variable assessing the similarity between the concurrent
and external control groups. The prior of <span class="math inline">\(tau\)</span> follows a Gamma distribution
(default: shape = 1, rate = 0.001) and a half-Cauchy distribution
(default: location = 0, scale = 0.2), respectively, in methods 3 and 4.
Users can update the default values for the parameter if they wish to
customize the hyper-prior.</p>
<p>After users state the prior choices and the simulated data is ready
for use, the Markov chain Monte Carlo (MCMC) algorithm is deployed to
obtain samples from the posterior distribution.</p>
</div>
<div class="section level2">
<h2 id="example-of-use">Example of use<a class="anchor" aria-label="anchor" href="#example-of-use"></a>
</h2>
<p>To demonstrate how to use the package to fit the analysis model we
first generate a dataset where the time to event is drawn from the
following distribution:</p>
<p><span class="math display">\[
t_i \sim Weibull(0.95, \lambda_i)
\]</span> Where:</p>
<p><span class="math display">\[
\lambda_i =  \frac{1}{150}I_{ec} \times \frac{1}{200}I_{cc} \times
\frac{1}{400}I_{trt} \times
exp(0.2\times x_{age} - 0.1\times I_{female})
\]</span></p>
<ul>
<li>
<span class="math inline">\(I_{ec}\)</span> is 1 if the patient is
in the external trial else 0<br>
</li>
<li>
<span class="math inline">\(I_{cc}\)</span> is 1 if the patient is
in the concurrent trial else 0<br>
</li>
<li>
<span class="math inline">\(I_{trt}\)</span> is 1 if the patient is
in the treatment arm else 0<br>
</li>
<li>
<span class="math inline">\(I_{female}\)</span> is 1 if the patient
is female else 0<br>
</li>
<li>
<span class="math inline">\(x_{age}\)</span> is the patient’s
age</li>
</ul>
<p>Patients are then censored by drawing a censoring time from the
exponential distribution with a rate parameter of <span class="math inline">\(\lambda = 1/400\)</span></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">psborrow</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/flexsurv-dev" class="external-link">flexsurv</a></span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">401</span><span class="op">)</span>

<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span>

<span class="va">grp_lvl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CC"</span>, <span class="st">"TRT"</span>, <span class="st">"EC"</span><span class="op">)</span>
<span class="va">sex_lvl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>

<span class="va">log_hr_grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="st">"TRT"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">400</span><span class="op">)</span>,
    <span class="st">"CC"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">200</span><span class="op">)</span>,
    <span class="st">"EC"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">150</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">log_hr_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="st">"Male"</span> <span class="op">=</span> <span class="fl">0</span>,
    <span class="st">"Female"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>
<span class="op">)</span>

<span class="va">log_hr_age</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>

<span class="va">Shape</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
    pt <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>,
    grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">grp_lvl</span>, size <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>,
        levels <span class="op">=</span> <span class="va">grp_lvl</span>
    <span class="op">)</span>,
    sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">sex_lvl</span>, size <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span>,
        levels <span class="op">=</span> <span class="va">sex_lvl</span>
    <span class="op">)</span>,
    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
    lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span>
        <span class="va">log_hr_age</span> <span class="op">*</span> <span class="va">age</span> <span class="op">+</span>
        <span class="va">log_hr_sex</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span>
        <span class="va">log_hr_grp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span><span class="op">]</span>
    <span class="op">)</span>,
    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/flexsurv/man/WeibullPH.html" class="external-link">rweibullPH</a></span><span class="op">(</span><span class="va">n</span>, scale <span class="op">=</span> <span class="va">lambda</span>, shape <span class="op">=</span> <span class="va">Shape</span><span class="op">)</span>,
    centime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span> <span class="op">/</span> <span class="fl">400</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">time</span> <span class="op">&lt;=</span> <span class="va">centime</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">time</span> <span class="op">&lt;=</span> <span class="va">centime</span>, <span class="va">time</span>, <span class="va">centime</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pt</span>, <span class="va">grp</span>, <span class="va">age</span>, <span class="va">sex</span>, <span class="va">time</span>, <span class="va">event</span><span class="op">)</span>

<span class="va">dat</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,000 × 6</span></span>
<span class="co">#&gt;       pt grp      age sex     time event</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 TRT    1.12  Female  64.0     1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 CC    -<span style="color: #BB0000;">0.577</span> Female  14.3     0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 CC    -<span style="color: #BB0000;">0.281</span> Female 190.      0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 CC    -<span style="color: #BB0000;">0.371</span> Male   348.      0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 CC     1.29  Female  43.6     1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 EC    -<span style="color: #BB0000;">0.840</span> Male    27.8     0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 EC     0.901 Female 706.      1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 TRT    0.906 Female 105.      1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 CC     1.43  Male    57.9     1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 TRT    2.75  Female  85.9     1</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 990 more rows</span></span></code></pre></div>
<p>To conduct an analysis we need to use the <code><a href="../reference/apply_mcmc.html">apply_mcmc()</a></code>
function. However to use this function we first need to convert our data
into the required format. Full details of the required format can be
found in <code><a href="../reference/apply_mcmc.html">help(apply_mcmc)</a></code> however an example of this is
shown below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">grp</span> <span class="op">==</span> <span class="st">"TRT"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ext <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">grp</span> <span class="op">==</span> <span class="st">"EC"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cnsr <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">event</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pt</span>, <span class="va">trt</span>, <span class="va">ext</span>, <span class="va">time</span>, <span class="va">cnsr</span>, <span class="va">sex</span>, <span class="va">age</span><span class="op">)</span>

<span class="va">dat2</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,000 × 7</span></span>
<span class="co">#&gt;       pt   trt   ext  time  cnsr sex       age</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1     1     0  64.0     0 Female  1.12 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2     0     0  14.3     1 Female -<span style="color: #BB0000;">0.577</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3     0     0 190.      1 Female -<span style="color: #BB0000;">0.281</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4     0     0 348.      1 Male   -<span style="color: #BB0000;">0.371</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5     0     0  43.6     0 Female  1.29 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6     0     1  27.8     1 Male   -<span style="color: #BB0000;">0.840</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7     0     1 706.      0 Female  0.901</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8     1     0 105.      0 Female  0.906</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9     0     0  57.9     0 Male    1.43 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10     1     0  85.9     0 Female  2.75 </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 990 more rows</span></span></code></pre></div>
<p>We can now pass our data to <code><a href="../reference/apply_mcmc.html">apply_mcmc()</a></code> to produce our
posterior samples. Prior distributions are specified using the
<code><a href="../reference/set_prior.html">set_prior()</a></code> function, details for which can be found in
<code><a href="../reference/set_prior.html">help(set_prior)</a></code> as well as the user-guide vignette.
Covariates for the analysis model need to be specified by a 1-sided
formula provided to the <code>formula_cov</code> argument. Note that the
treatment indicator is automatically added to the model and should not
be specified in the covariate formula; if you require treatment
interactions these should be specified explicitly via
<code>trt:cov</code> rather than by <code>trt*cov</code>. The intercept
term must always be included in this formula. You are advised to leave
the <code>pred</code> parameter as either “all” or “ps” depending on
your requirements. If you do wish to restrict the covariates included in
the model then this should be done by omitting them from the
<code>formula_cov</code> rather than the <code>pred</code> argument in
<code><a href="../reference/set_prior.html">set_prior()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">postsamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_mcmc.html">apply_mcmc</a></span><span class="op">(</span>
    dt <span class="op">=</span> <span class="va">dat2</span>,
    formula_cov <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,
    priorObj <span class="op">=</span> <span class="fu"><a href="../reference/set_prior.html">set_prior</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="st">"all"</span>, prior <span class="op">=</span> <span class="st">"gamma"</span>, r0 <span class="op">=</span> <span class="fl">0.85</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
    n.chains <span class="op">=</span> <span class="fl">1</span>,
    n.adapt <span class="op">=</span> <span class="fl">100</span>,
    n.burn <span class="op">=</span> <span class="fl">100</span>,
    n.iter <span class="op">=</span> <span class="fl">200</span>,
    seed <span class="op">=</span> <span class="fl">47</span>
<span class="op">)</span>
<span class="co">#&gt; Input all is found in pred. Any other input is disregarded.</span></code></pre></div>
<p>From here we can extract our posterior samples as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/apply_mcmc.html">extract_samples</a></span><span class="op">(</span><span class="va">postsamp</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;       HR_cc_hc HR_trt_cc  alpha[1]  alpha[2]   beta_trt  beta_age</span>
<span class="co">#&gt; [1,] 0.9011503 0.3671814 -4.949371 -4.845288 -1.0018994 0.2745032</span>
<span class="co">#&gt; [2,] 0.9738321 0.4697018 -4.876703 -4.850186 -0.7556573 0.2539210</span>
<span class="co">#&gt; [3,] 0.9455914 0.3991505 -4.942033 -4.886088 -0.9184167 0.3249545</span>
<span class="co">#&gt; [4,] 0.9798274 0.4088358 -4.897589 -4.877210 -0.8944417 0.2851334</span>
<span class="co">#&gt; [5,] 1.0144295 0.3605800 -4.859848 -4.874174 -1.0200414 0.2935454</span>
<span class="co">#&gt; [6,] 1.0137068 0.3633342 -4.903234 -4.916847 -1.0124321 0.2535249</span>
<span class="co">#&gt;      beta_sexFemale        r0       tau</span>
<span class="co">#&gt; [1,]    -0.25909116 0.9201647  360.0789</span>
<span class="co">#&gt; [2,]    -0.25321051 0.9204208  283.2014</span>
<span class="co">#&gt; [3,]    -0.22758668 0.9211114  667.9504</span>
<span class="co">#&gt; [4,]    -0.16777557 0.9215409 2315.9094</span>
<span class="co">#&gt; [5,]    -0.18770880 0.9191615 2675.4973</span>
<span class="co">#&gt; [6,]    -0.09992967 0.9020110  783.1036</span></code></pre></div>
<p>For reference the returned parameters are:</p>
<ul>
<li><p><code>HR_cc_hc</code> - The hazard ratio between the concurrent
control arm and the historical control arm. This can be be thought of as
the ratio of the scale parameter between the baseline trial distribution
and the baseline external control distribution. This is equivalent to
<code>exp(alpha[1] - alpha[2])</code></p></li>
<li><p><code>HR_trt_cc</code> - The hazard ratio between the treatment
arm and the concurrent control arm. This is equivalent to
<code>exp(beta_trt)</code></p></li>
<li><p><code>alpha[1]</code> - The shape parameter for the trial’s
baseline distribution</p></li>
<li><p><code>alpha[2]</code> - The shape parameter for the historical
control’s baseline distribution</p></li>
<li><p><code>beta_trt</code> - The log-hazard ratio for the treatment
effect. This is equivalent to <code>log(HR_trt_cc)</code></p></li>
<li><p><code>beta_age</code> - The log-hazard ratio for the covariate
<code>age</code></p></li>
<li><p><code>beta_sexFemale</code> - The log-hazard ratio for the
covariate <code>sexFemale</code></p></li>
<li><p><code>r0</code> - The scale parameter for the baseline
distribution of both the trial and the historical control</p></li>
<li><p><code>tau/sigma</code> - The precision/variance for
<code>alpha[1]</code> i.e. controls how much information is borrowed
from the historical control arm</p></li>
</ul>
<p>If <code>prior = "no_ext"</code> or <code>prior = "full_ext"</code>
then <code>alpha[1]</code> and <code>alpha[2]</code> will be replaced
with a single parameter <code>alpha</code> representing the shape
parameter for the single baseline distribution for the trail.</p>
<p>Additionally general summary statistics of our samples can be
generated by the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">postsamp</span><span class="op">)</span>
<span class="co">#&gt;        parameter         mean           sd        lci           uci</span>
<span class="co">#&gt; 1       HR_cc_hc    0.9901932   0.03668913  0.9120554    1.06368087</span>
<span class="co">#&gt; 2      HR_trt_cc    0.3857669   0.03881582  0.3230326    0.46980137</span>
<span class="co">#&gt; 3       alpha[1]   -4.9414910   0.09106815 -5.0775808   -4.76802672</span>
<span class="co">#&gt; 4       alpha[2]   -4.9309512   0.08729994 -5.0899134   -4.75289074</span>
<span class="co">#&gt; 5       beta_trt   -0.9573926   0.09823656 -1.1300021   -0.75544616</span>
<span class="co">#&gt; 6       beta_age    0.2781143   0.04180654  0.2019639    0.35759578</span>
<span class="co">#&gt; 7 beta_sexFemale   -0.1390660   0.07769175 -0.2664242    0.02923811</span>
<span class="co">#&gt; 8             r0    0.9239697   0.01768511  0.8921297    0.95277956</span>
<span class="co">#&gt; 9            tau 1002.0669283 999.10913348 49.5932394 3564.40952449</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Lu, Y., Lin, A., Pang, H., Zhu, J. (2021). PSBORROW: BAYESIAN
DYNAMIC BORROWING R TOOL FOR COMPLEX INNOVATIVE TRIAL DESIGNS. ASA
Biopharmaceutical Report, 28 (3), 11-19.</p></li>
<li><p>Lewis, C. J., Sarkar, S., Zhu, J., &amp; Carlin, B. P. (2019).
Borrowing from historical control data in cancer drug development: a
cautionary tale and practical guidelines. Statistics in
biopharmaceutical research, 11(1), 67-78.</p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Yichen Lu, Aijing Lin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
